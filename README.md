# Netbooting raspi

Based on https://github.com/zouppen/raspberrypi-podman so first install that container.

Then,

```sh
podman build -t raspi-netboot .
```

## Dumping the image for NFS and TFTP

The following script dumps the image generated by build and creates a
btrfs image ready for deployment. It requires no root privileges,
everything is done in a modified user namespace.

```
podman unshare ./generate_image raspi-netboot image.img
```

The file is not compressed and have no submodules so if you want them,
mount the partition manually and defrag.

Mount the image and read `/boot` directory from there to your TFTP root.

### Boot directory preparation

If PXE booting or with boot only SD card, you need to adjust
`cmdline.txt` and add the following items to the kernel command line
and removing existing root item:

```
rw root=/dev/nfs nfsroot=/srv/nfs/info,nfsvers=4.2 nfsfile=btrfs.img apparmor=0 net.ifnames=0
```

Adding `net.ifnames=0` and `apparmor=0` is optional but helps to solve issues with NFS booting.

## Author

Written by Joel Lehtonen / Zouppen. Licenced under the terms of MIT license.
